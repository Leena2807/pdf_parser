<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SPPU Result Parser | Elite Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    /* Legendary Executive Theme */
    :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --accent: #10b981;
        --bg: #0f172a;
        --card-bg: rgba(30, 41, 59, 0.7);
        --text-main: #f8fafc;
        --text-muted: #94a3b8;
        --border: rgba(255, 255, 255, 0.1);
        --success: #10b981;
        --error: #ef4444;
        --glass: rgba(255, 255, 255, 0.03);
    }

    @keyframes introScale {
        0% { opacity: 0; transform: scale(0.95); filter: blur(10px); }
        100% { opacity: 1; transform: scale(1); filter: blur(0); }
    }

    @keyframes shine {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    @keyframes rowSlide {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    * { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

    body { 
        font-family: 'Inter', system-ui, -apple-system, sans-serif; 
        line-height: 1.6;
        background: radial-gradient(circle at top left, #1e1b4b, #0f172a); 
        background-attachment: fixed;
        color: var(--text-main);
        margin: 0;
        padding: 60px 20px;
        min-height: 100vh;
    }

    .container { 
        max-width: 1200px; 
        margin: auto; 
        background: var(--card-bg); 
        padding: 50px; 
        border-radius: 24px; 
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        animation: introScale 0.8s ease-out forwards;
    }

    .header-section {
        text-align: center;
        margin-bottom: 40px;
    }

    h2 { 
        margin: 0;
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: -0.05em;
        background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        display: inline-block;
    }

    .subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
        margin-top: 10px;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Form Styling */
    form {
        position: relative;
        display: flex;
        gap: 15px;
        align-items: center;
        background: var(--glass);
        padding: 30px;
        border-radius: 20px;
        border: 1px solid var(--border);
        margin-bottom: 25px;
        flex-wrap: wrap;
        overflow: hidden;
    }

    form::before {
        content: '';
        position: absolute;
        top: 0; left: -100%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
        transition: 0.5s;
    }

    form:hover::before {
        left: 100%;
        transition: 0.8s;
    }

    /* Search Section Styling */
    .search-section {
        margin-bottom: 40px;
        display: flex;
        justify-content: center;
    }

    .search-container {
        position: relative;
        width: 100%;
        max-width: 500px;
    }

    #searchInput {
        width: 100%;
        padding: 16px 20px 16px 45px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--border);
        border-radius: 14px;
        color: var(--text-main);
        font-size: 1rem;
        outline: none;
        backdrop-filter: blur(5px);
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
    }

    #searchInput:focus {
        border-color: var(--primary);
        background: rgba(0, 0, 0, 0.4);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15), 0 10px 20px -5px rgba(0,0,0,0.3);
    }

    #searchInput::placeholder {
        color: var(--text-muted);
        opacity: 0.6;
    }

    /* Subtle search icon using CSS */
    .search-container::before {
        content: 'üîç';
        position: absolute;
        left: 18px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.9rem;
        opacity: 0.5;
        pointer-events: none;
    }

    input[type="file"] {
        flex: 1;
        padding: 12px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border);
        border-radius: 12px;
        color: var(--text-main);
        cursor: pointer;
    }

    input[type="file"]::-webkit-file-upload-button {
        background: var(--primary);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        margin-right: 10px;
        font-weight: 600;
        cursor: pointer;
    }

    button { 
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border: none;
        padding: 16px 32px;
        border-radius: 12px;
        font-weight: 700;
        letter-spacing: 0.02em;
        box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.4);
        cursor: pointer;
    }

    button:hover { 
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 20px 30px -10px rgba(99, 102, 241, 0.6);
    }

    button:active { transform: translateY(0); }

    /* Feedback States */
    .error { 
        background: rgba(220, 38, 38, 0.1);
        color: #fca5a5; 
        padding: 20px;
        border-radius: 12px;
        border: 1px solid rgba(220, 38, 38, 0.2);
        margin-bottom: 30px; 
        display: none; 
        font-weight: 500;
        backdrop-filter: blur(10px);
    }

    /* Table Styling */
    .table-container {
        overflow-x: auto;
        border-radius: 20px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid var(--border);
    }

    table { 
        width: 100%; 
        border-collapse: collapse;
        min-width: 800px;
    }

    th { 
        background: rgba(255, 255, 255, 0.03);
        padding: 20px; 
        text-align: left; 
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--text-muted);
        border-bottom: 1px solid var(--border);
    }

    td { 
        padding: 20px; 
        border-bottom: 1px solid var(--border); 
        font-size: 0.95rem;
        color: #cbd5e1;
    }

    tbody tr {
        opacity: 0;
        animation: rowSlide 0.5s ease-out forwards;
    }

    tbody tr:hover td {
        background: rgba(255, 255, 255, 0.05);
        color: white;
    }

    /* Status Badges */
    .pass { 
        background: rgba(16, 185, 129, 0.1);
        color: #34d399;
        padding: 6px 14px;
        border-radius: 99px;
        font-size: 0.75rem;
        font-weight: 800;
        border: 1px solid rgba(16, 185, 129, 0.2);
        box-shadow: 0 0 15px rgba(16, 185, 129, 0.1);
    }
    
    .fail { 
        background: rgba(239, 68, 68, 0.1);
        color: #f87171;
        padding: 6px 14px;
        border-radius: 99px;
        font-size: 0.75rem;
        font-weight: 800;
        border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        form { flex-direction: column; align-items: stretch; padding: 20px; }
        .container { padding: 30px 15px; border-radius: 0; }
        h2 { font-size: 1.8rem; }
        .search-container { max-width: 100%; }
    }
</style>
</head>

<body>
<div class="container">
    <div class="header-section">
        <h2>SPPU Result Parser</h2>
        <p class="subtitle">Next-generation academic data extraction. Simply drop your PDF ledgers and let the engine do the rest.</p>
    </div>

    <div id="error" class="error"></div>

    <!-- Upload Section -->
    <form id="uploadForm">
        <input type="file" id="fileInput" accept="application/pdf" multiple required />
        <button type="submit">
            <span>Process Intelligence</span>
        </button>
    </form>

    <!-- Refined Search Section -->
    <div class="search-section">
        <div class="search-container">
            <input
                type="text"
                id="searchInput"
                placeholder="Lookup candidate intelligence..."
            />
        </div>
    </div>

    <!-- Results Section -->
    <div class="table-container">
        <table id="resultTable" style="display:none">
            <thead>
                <tr>
                    <th>Identity/Seat</th>
                    <th>Candidate Name</th>
                    <th>SEM I</th>
                    <th>SEM II</th>
                    <th>Status</th>
                    <th>Origin File</th>
                </tr>
            </thead>
            <tbody id="resultBody"></tbody>
        </table>
    </div>
</div>

<script>
const form = document.getElementById("uploadForm");
const fileInput = document.getElementById("fileInput");
const errorBox = document.getElementById("error");
const table = document.getElementById("resultTable");
const tbody = document.getElementById("resultBody");
const searchInput = document.getElementById("searchInput");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    errorBox.style.display = "none";
    tbody.innerHTML = "";
    table.style.display = "none";

    const files = fileInput.files;
    if (!files.length) return;

    const formData = new FormData();
    for (const file of files) {
        formData.append("file", file);
    }

    try {
        const res = await fetch("http://localhost:5000/add_pdf", {
            method: "POST",
            body: formData
        });

        const data = await res.json();

        if (!res.ok) {
            throw new Error(data.message || "Upload failed");
        }

        if (!data.students || data.students.length === 0) {
            throw new Error("No students extracted");
        }

        data.students.forEach((s, index) => {
            addRow(s, index);
        });
        table.style.display = "table";

    } catch (err) {
        errorBox.textContent = err.message;
        errorBox.style.display = "block";
    }
});

function addRow(s, index) {
    const tr = document.createElement("tr");
    tr.style.animationDelay = `${index * 0.05}s`;
    
    tr.innerHTML = `
        <td style="font-weight: 700; color: #818cf8; letter-spacing: 0.05em;">${s.seat_number}</td>
        <td style="color: #f8fafc; font-weight: 500;">${s.name}</td>
        <td>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="height: 4px; width: 4px; border-radius: 50%; background: var(--primary);"></span>
                <span style="font-family: 'JetBrains Mono', monospace;">${s.sgpa_sem1 ?? "--"}</span>
            </div>
        </td>
        <td>
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="height: 4px; width: 4px; border-radius: 50%; background: var(--accent);"></span>
                <span style="font-family: 'JetBrains Mono', monospace;">${s.sgpa_sem2 ?? "--"}</span>
            </div>
        </td>
        <td><span class="${s.result === 'PASS' ? 'pass' : 'fail'}">${s.result}</span></td>
        <td style="color: var(--text-muted); font-size: 0.8rem; font-style: italic;">${s.source_file}</td>
    `;
    tbody.appendChild(tr);
}

searchInput.addEventListener("input", async () => {
    const q = searchInput.value.trim();

    if (q.length === 0) return;

    try {
        const res = await fetch(`http://localhost:5000/search/${q}`);
        const data = await res.json();

        tbody.innerHTML = "";
        
        if (data.length > 0) {
            data.forEach((s, i) => addRow(s, i));
            table.style.display = "table";
        } else {
            table.style.display = "none";
        }
    } catch (e) {
        console.error("Search failed", e);
    }
});
</script>
</body>
</html>